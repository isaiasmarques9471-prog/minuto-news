<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minuto News ‚Äî √∫ltimas not√≠cias em tempo real</title>
  <meta name="description" content="Minuto News ‚Äî portal de Fortaleza e Cear√° com cobertura Brasil e Mundo. √öltima hora, pol√≠tica, sa√∫de e esportes.">
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />
  <style>
    :root { --bg:#0a0a0c; --text:#f3f3f6; --muted:#b7b9c0; --card:#15161a; --border:#262833; --red:#ff3232; --cyan:#00c8ff; --shadow:rgba(0,0,0,.25); }
    [data-theme="light"] { --bg:#ffffff; --text:#0b0c0f; --muted:#40424a; --card:#ffffff; --border:#e7e9f0; --shadow:rgba(0,0,0,.08);}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:20;background:rgba(10,10,12,.7);backdrop-filter:saturate(1.2) blur(8px);border-bottom:1px solid var(--border)}
    .top{display:flex;align-items:center;gap:12px;padding:10px 16px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800}
    .logo img{width:40px;height:40px}
    .badge{font-size:12px;padding:3px 8px;border-radius:8px;border:1px solid var(--border);background:var(--card)}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-1px)}
    .btn.ghost{background:transparent}
    .right{margin-left:auto;display:flex;gap:8px;align-items:center}
    .search{position:relative}
    .search input{padding:8px 12px 8px 34px;border-radius:10px;border:1px solid var(--border);background:#0f1014;color:var(--text)}
    .search .icon{position:absolute;left:10px;top:7px;opacity:.6}
    .toggle{border:1px solid var(--border);border-radius:10px;padding:8px 12px;cursor:pointer}
    /* Weather badge */
    .weather{display:flex;gap:8px;align-items:center;font-size:12px;border:1px solid var(--border);border-radius:10px;padding:6px 8px;background:var(--card)}
    .ticker{border-top:1px solid var(--border);background:#0f0f13}
    .row{display:flex;align-items:center;gap:12px;padding:8px 16px;overflow:hidden}
    .marquee{white-space:nowrap;animation:scroll 30s linear infinite}
    @keyframes scroll{from{transform:translateX(0)} to{transform:translateX(-50%)}}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:960px){.grid{grid-template-columns:2fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 8px 24px var(--shadow)}
    .body{padding:16px}
    .muted{color:var(--muted)}
    .hero{display:grid;grid-template-columns:1fr}
    @media(min-width:860px){.hero{grid-template-columns:1fr 1fr}}
    .chip{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:3px 8px;font-size:12px}
    .chip.ce{border-color:var(--cyan);color:var(--cyan)}
    .primary{background:var(--red);color:#fff;font-weight:800;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .section{margin-top:18px}
    .title{display:flex;align-items:center;gap:8px;font-weight:900;margin:6px 0 10px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 10px var(--red)}
    .dot.ce{background:var(--cyan);box-shadow:0 0 10px var(--cyan)}
    footer{border-top:1px solid var(--border);padding:24px 16px}
    /* ---- Cards horizontais B1 (CNN style) ---- */
    .hcard{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:12px}
    @media(min-width:680px){.hcard{grid-template-columns:160px 1fr}}
    .hcard img{width:100%;height:100%;object-fit:cover;border-radius:12px}
    .hcard:hover{background:linear-gradient(0deg,rgba(255,255,255,.02),rgba(255,255,255,.02))}
    .hcard h3{margin:4px 0 6px 0}
    .meta{font-size:12px;color:var(--muted)}
    /* badges autom√°ticos */
    .badge-urgente{background:#ff3232;color:#fff;border-radius:8px;padding:2px 8px;margin-right:6px;font-size:12px}
    .badge-alerta{background:#ffb020;color:#111;border-radius:8px;padding:2px 8px;margin-right:6px;font-size:12px}
    .badge-destaque{background:#00c8ff;color:#111;border-radius:8px;padding:2px 8px;margin-right:6px;font-size:12px}
    /* ---- Skeleton loaders ---- */
    .skeleton{background:linear-gradient(90deg,#121317,#151720,#121317);animation:shine 1.2s linear infinite;background-size:200% 100%}
    @keyframes shine{from{background-position:200% 0} to{background-position:-200% 0}}
    .sk-card{border-radius:16px;border:1px solid var(--border);padding:12px}
    .sk-thumb{height:100px;border-radius:12px}
    .sk-line{height:10px;border-radius:6px;margin-top:10px}
  </style>
</head>
<body data-theme="dark">
<header>
  <div class="top container">
    <div class="logo">
      <img src="/assets/logo.svg" alt="Minuto News">
      <div>
        <div>Minuto <span style="color:var(--cyan)">News</span></div>
        <div class="badge">Ao vivo</div>
      </div>
    </div>
    <nav id="menu"></nav>
    <div class="right">
      <div class="weather" id="weather">üå§Ô∏è Fortaleza ‚Äî carregando‚Ä¶</div>
      <div class="search"><span class="icon">üîé</span><input id="q" placeholder="Buscar..."></div>
      <button id="theme" class="toggle">üåì</button>
    </div>
  </div>
  <div class="ticker">
    <div class="row container">
      <strong>üóûÔ∏è √öltima hora</strong>
      <div class="marquee" id="ticker"></div>
    </div>
  </div>
</header>

<main class="container" style="padding-top:18px;">
  <div class="grid">
    <section>
      <div class="card hero">
        <div><img id="heroImg" src="/assets/fallback_fortaleza.svg" alt="Manchete" style="width:100%;height:100%;object-fit:cover"></div>
        <div class="body">
          <div>
            <span class="badge-destaque" id="heroBadge" style="display:none"></span>
            <span class="chip" id="heroCat">Cear√° Agora</span>
          </div>
          <h1 id="heroTitle" style="margin:10px 0 6px 0">Minuto News ‚Äî √∫ltimas not√≠cias em tempo real</h1>
          <p class="muted" id="heroDesc">Cobertura de Fortaleza, Cear√°, Brasil e Mundo.</p>
          <p class="muted" id="heroTime">Atualizado agora</p>
          <button class="primary" id="heroBtn">Ler agora ‚Üí</button>
        </div>
      </div>

      <div class="section">
        <div class="title"><span class="dot ce"></span> CEAR√Å AGORA</div>
        <div id="ceList" class="list">
          <!-- skeleton -->
          <div class="sk-card skeleton"><div class="sk-thumb"></div><div class="sk-line"></div><div class="sk-line" style="width:70%"></div></div>
          <div class="sk-card skeleton"><div class="sk-thumb"></div><div class="sk-line"></div><div class="sk-line" style="width:70%"></div></div>
        </div>
      </div>

      <div class="section">
        <div class="title"><span class="dot"></span> √öltimas</div>
        <div id="latestList" class="list">
          <!-- skeleton -->
          <div class="sk-card skeleton"><div class="sk-thumb"></div><div class="sk-line"></div><div class="sk-line" style="width:70%"></div></div>
          <div class="sk-card skeleton"><div class="sk-thumb"></div><div class="sk-line"></div><div class="sk-line" style="width:70%"></div></div>
        </div>
      </div>
    </section>

    <aside>
      <div class="card"><div class="body">
        <div class="title"><span class="dot"></span> Em alta</div>
        <div id="trending">Carregando‚Ä¶</div>
      </div></div>

      <div class="card" style="margin-top:12px;"><div class="body">
        <div class="title"><span class="dot"></span> Newsletter</div>
        <p class="muted">Receba alertas de √∫ltima hora no seu e-mail.</p>
        <form onsubmit="event.preventDefault(); alert('Inscri√ß√£o registrada!'); this.reset();">
          <input placeholder="seu@email">
          <button class="primary" style="margin-top:10px;">Inscrever</button>
        </form>
      </div></div>
    </aside>
  </div>
</main>

<footer>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
    <div style="display:flex;align-items:center;gap:8px;">
      <img src="/assets/logo.svg" style="width:26px;height:26px" alt="logo">
      <strong>Minuto News</strong>
    </div>
    <div class="muted">Edi√ß√£o: Equipe Minuto News ‚Ä¢ Fortaleza ‚Äî CE ‚Ä¢ ¬© <span id="year"></span></div>
  </div>
</footer>

<script>
const MENU = ["√öltima Hora","Fortaleza","Cear√°","Brasil","Mundo","Sa√∫de","Esportes"];
const menuEl = document.getElementById('menu');
MENU.forEach(m => {
  const b = document.createElement('button');
  b.className = "btn ghost";
  b.textContent = m;
  b.onclick = () => loadLatest(m);
  menuEl.appendChild(b);
});

// Tema
const state = { theme: (localStorage.getItem('mn_theme')||'dark') };
function applyTheme(){ document.body.setAttribute('data-theme', state.theme); localStorage.setItem('mn_theme', state.theme); }
document.getElementById('theme').addEventListener('click', ()=>{ state.theme = state.theme==='dark'?'light':'dark'; applyTheme() });
applyTheme();

function timeAgo(d){ const ts=new Date(d).getTime(); const diff=Date.now()-ts; const m=Math.floor(diff/60000);
  if(m<1) return 'agora'; if(m<60) return m+' min'; const h=Math.floor(m/60); if(h<24) return h+' h'; return Math.floor(h/24)+' d'; }

// Posts locais do Admin
function getLocalPosts(){ try { return JSON.parse(localStorage.getItem('mn_posts')||'[]'); } catch(e){ return []; } }

// Classifica√ß√£o para badges autom√°ticas
function classifyBadge(title){
  const t = (title||'').toLowerCase();
  if(/urgente|agora|explos√£o|desabamento|interdi√ß√£o|desastre|morreu|morta|assalto|pol√≠cia/.test(t)) return 'urgente';
  if(/alerta|chuva|enchente|lota√ß√£o|desabastecimento|tr√¢nsito/.test(t)) return 'alerta';
  if(/exclusivo|entrevista|especial|an√°lise/.test(t)) return 'destaque';
  return null;
}

// Card horizontal (B1)
function hcard(item, chip='Not√≠cia'){
  const badge = classifyBadge(item.title);
  const badgeHtml = badge==='urgente' ? '<span class="badge-urgente">üî• Urgente</span>' :
                    badge==='alerta' ? '<span class="badge-alerta">‚ö†Ô∏è Alerta</span>' :
                    badge==='destaque' ? '<span class="badge-destaque">üéØ Destaque</span>' : '';
  return `
  <a class="card" href="${item.link||'#'}" target="_blank" rel="noopener" onclick="trackClick('${chip}')">
    <div class="hcard">
      <img src="${item.img}" alt="">
      <div>
        <div style="display:flex;align-items:center;gap:8px">${badgeHtml}<span class="chip ${chip==='CEAR√Å'?'ce':''}">${chip}</span></div>
        <h3>${item.title}</h3>
        <div class="meta">${timeAgo(item.pubDate||new Date())} ‚Ä¢ ${item.source||'Google News'}</div>
      </div>
    </div>
  </a>`;
}

async function fetchRSS(q){
  const url = '/api/rss?q='+encodeURIComponent(q);
  const res = await fetch(url);
  const xml = await res.text();
  const doc = new DOMParser().parseFromString(xml, 'text/xml');
  const items = [...doc.querySelectorAll('item')].slice(0, 12).map(it => {
    const title = it.querySelector('title')?.textContent || '';
    const link = it.querySelector('link')?.textContent || '#';
    const pubDate = it.querySelector('pubDate')?.textContent || new Date().toUTCString();
    const source = it.querySelector('source')?.textContent || '';
   let img = it.querySelector('media\\:content, enclosure')?.getAttribute('url');

// tentativa n¬∫2: achar <img> dentro do HTML
if(!img){
  const desc = it.querySelector('description')?.textContent || '';
  const htmlMatch = desc.match(/<img[^>]+src="([^"]+)"/i);
  if(htmlMatch) img = htmlMatch[1];
}

// tentativa n¬∫3: achar links diretos jpg/png no description
if(!img){
  const desc = it.querySelector('description')?.textContent || '';
  const match = desc.match(/https?:\/\/[^"]+\.(jpg|jpeg|png|webp)/i);
  if(match) img = match[0];
}

// Fallback por categoria
if(!img){
  if(q.includes('Cear√°') || q.includes('Fortaleza')) img = '/assets/fallback_fortaleza.svg';
  else if(q.includes('Brasil')) img = '/assets/brasil.svg';
  else if(q.includes('Mundo')) img = '/assets/mundo.svg';
  else if(q.includes('Esporte')) img = '/assets/esportes.svg';
  else img = '/assets/fallback_fortaleza.svg';
}
      const desc = it.querySelector('description')?.textContent || '';
      const match = desc.match(/https?:\/\/[^"]+\.(jpg|jpeg|png|webp)/i);
      if(match) img = match[0];
    }
    if(!img){ img = '/assets/fallback_fortaleza.svg'; }
    return { title, link, pubDate, source, img };
  });
  return items;
}

// Cear√° Agora (preenche Hero)
async function loadCeara(){
  const ce = document.getElementById('ceList');
  const items = await fetchRSS('Fortaleza OR "Cear√°" OR Nordeste when:1d');
  ce.innerHTML = items.map(it => hcard(it, 'CEAR√Å')).join('');
  if(items.length){
    document.getElementById('heroImg').src = items[0].img;
    document.getElementById('heroTitle').textContent = items[0].title;
    document.getElementById('heroDesc').textContent = 'Cobertura especial do Cear√°';
    document.getElementById('heroTime').textContent = 'Atualizado '+timeAgo(items[0].pubDate)+' atr√°s';
    document.getElementById('heroBtn').onclick = () => window.open(items[0].link, '_blank');
    const b = classifyBadge(items[0].title);
    const heroBadge = document.getElementById('heroBadge');
    if(b==='urgente'){ heroBadge.textContent='üî• Urgente'; heroBadge.style.display='inline-block'; }
    else if(b==='alerta'){ heroBadge.textContent='‚ö†Ô∏è Alerta'; heroBadge.style.display='inline-block'; }
    else if(b==='destaque'){ heroBadge.textContent='üéØ Destaque'; heroBadge.style.display='inline-block'; }
  }
}

// √öltimas + Trendings + mistura com posts locais
async function loadLatest(category='Brasil'){
  const list = document.getElementById('latestList');
  list.innerHTML = '<div class="sk-card skeleton"><div class="sk-thumb"></div><div class="sk-line"></div><div class="sk-line" style="width:70%"></div></div>';
  const items = await fetchRSS(category+' when:2h');
  const locals = getLocalPosts().map(p => ({ title:p.title, link:'/post/?t='+encodeURIComponent(p.title), pubDate:p.date||new Date(), source:'Minuto News', img:'/assets/fallback_fortaleza.svg' }));
  const merged = locals.concat(items).slice(0, 12);
  list.innerHTML = merged.map(it => hcard(it, category)).join('');
  document.getElementById('trending').innerHTML = merged.slice(0,6).map(it => `‚Ä¢ <a href="${it.link}" target="_blank" onclick="trackClick('Trending')">${it.title}</a>`).join('<br>');
  trackImpression(category);
}

// Ticker
async function loadTicker(){
  const items = await fetchRSS('Brasil when:1h');
  document.getElementById('ticker').innerHTML = items.concat(items).map(it => `<span style="margin:0 24px;">${it.title}</span>`).join('');
}

// Weather (Fortaleza) via serverless /api/weather (Open-Meteo, sem chave)
async function loadWeather(){
  try{
    const r = await fetch('/api/weather');
    const j = await r.json();
    const w = document.getElementById('weather');
    if(j && j.temp!=null){ w.textContent = `üå§Ô∏è Fortaleza ${j.temp}¬∞C ‚Ä¢ ${j.desc} ‚Ä¢ vento ${j.wind} km/h`; }
  }catch(e){ /* ignora */ }
}

// Analytics simples (localStorage)
function trackImpression(cat){
  try{
    const a = JSON.parse(localStorage.getItem('mn_analytics')||'{}');
    const hour = new Date().getHours();
    a.categories = a.categories||{};
    a.hours = a.hours||{};
    a.categories[cat] = (a.categories[cat]||0)+1;
    a.hours[hour] = (a.hours[hour]||0)+1;
    localStorage.setItem('mn_analytics', JSON.stringify(a));
  }catch(e){}
}
function trackClick(cat){ trackImpression(cat); }

document.getElementById('year').textContent = new Date().getFullYear();
loadWeather(); loadCeara(); loadLatest('Brasil'); loadTicker();
</script>
</body>
</html>
